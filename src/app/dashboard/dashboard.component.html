<div class="content">
    <div class="titre">
        <h1>Tableau de Bord</h1>
    </div>
    <div class="p-4">
        <table class="table table-dark table-striped text-white mt-4">
            <thead>
                <tr>
                    <th>Numéro</th>
                    <th>Montant</th>
                    <th>Etat</th>
                    <th>Date d'initiation</th>
                    <th>Taux de change</th>
                    <th>Tel Recepteur</th>
                    <th>Option</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="7" class="center px-4">
                        <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                            <i class="bi bi-plus-circle"></i>
                            Initier un transfert                        
                        </button>
                    </td>
                </tr>
                @for (transfert of transferts; track $index) {
                    <tr>
                        <th>{{transfert.num}}</th>
                        <td>{{transfert.montant}}</td>
                        <td><span class="badge bg-{{transfert.couleur}}">{{transfert.etat}}</span></td>
                        <td>{{transfert.date}}</td>
                        <td>{{transfert.taux}}</td>
                        <td>{{transfert.telRecepteur}}</td>
                        <td>
                            <button class="btn btn-danger mx-1" (click)="deleteTransfert(transfert.id)"><i class="bi bi-trash"></i></button>
                            @if (transfert.etat == "success") {
                                <button class="btn btn-info mx-1" (click)="generateInvoice(transfert)"><i class="bi bi-printer-fill"></i></button>
                            }                            
                        </td>
                    </tr>
                }
                @if (transferts.length == 0) {
                    <tr>
                        <td colspan="7" class="center px-4">
                            <button class="btn btn-outline-light w-100 border-0" disabled>
                                Aucun tranfert Pour le moment.
                            </button>
                        </td>
                    </tr>
                }            
            </tbody>
        </table>
    </div>
    <h1 class="text-warning my-4 text-center">Statistique</h1>
    <div class="p-4 text-white option-container">
        <div class="card bg-info">
            <div class="card-dash">
                <div class="p-4">
                    <h4 class="m-0">0.00 $</h4>
                    <h5 class="m-0">BALANCE</h5>
                </div>
                <div class="log">
                    <i class="bi bi-currency-dollar text-primary"></i>
                </div>
            </div>            
        </div>
        <div class="card bg-warning" >
            <div class="card-dash">
                <div class="p-4">
                    <h4 class="m-0">{{nbreEncour}}</h4>
                    <h5 class="m-0">En cour...</h5>
                </div>
                <div class="log">
                    <i class="bi bi-reception-1 text-danger"></i>
                </div>
            </div>
            
        </div>
        <div class="card bg-success">
            <div class="card-dash">
                <div class="p-4">
                    <h4 class="m-0">{{nbreSuccess}}</h4>
                    <h4 class="m-0">Success</h4>
                </div>
                <div class="log">
                    <i class="bi bi-check-circle-fill text-success"></i>
                </div>
            </div>
            
        </div>
        <div class="card bg-danger">
            <div class="card-dash ">
                <div class="p-4">
                    <h4 class="m-0">{{nbreEchec}}</h4>
                    <h4 class="m-0">Echec</h4>
                </div>
                <div class="log">
                    <i class="bi bi-x-circle-fill text-warning"></i>
                </div>
            </div>
            
        </div>
    </div>
</div>

<div class="modal modal-lg fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-info">
          <h5 class="modal-title" id="staticBackdropLabel">Initier un tranfert</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            @if (errChange !="" ) {
                <div class="alert alert-primary" role="alert">
                    {{errChange}}
                </div>
            }
            
            <div class="card card-change border-0 shadow">
                <div class="card-body border-0">
                    <table class="table border-0 table-dark table-striped">
                        <thead class="border-0">
                            <tr class="text-center">
                            <th scope="col">Envoyer</th>
                            <th scope="col">Recevoir</th>
                            </tr>
                        </thead>
                        <tbody class="border-0">
                            <tr>
                                <td>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" [(ngModel)]="montantSend" (input)="applyTaux()">
                                    </div>
                                </td>
                                <td>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" [(ngModel)]="montantRec" disabled>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="col-sm-10">
                                        <select class="form-select" [(ngModel)]="opSend" (change)="applyTaux()">
                                            @for (monaie of monaies; track $index) {
                                                <option value="{{monaie.id}}">{{monaie.operateur+'('+monaie.pays+')'}}</option>
                                            }                                            
                                        </select>
                                    </div>
                                </td>
                                <td>
                                    <div class="col-sm-10">
                                        <select class="form-select" [(ngModel)]="opRe" (change)="applyTaux()">
                                            @for (monaie of monaies; track $index) {
                                                <option value="{{monaie.id}}">{{monaie.operateur+'('+monaie.pays+')'}}</option>
                                            } 
                                        </select>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="p-2">
                        @if (monaieR && tauxApplicable && monaieR) {
                            <h4>1 {{monaieS}} = {{tauxApplicable+" "+monaieR}}</h4>
                        }@else {
                            <div class="spinner-grow" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        }                        
                    </div>
                    <h5>Information Sur le recepteur</h5>
                    <div class="mb-3">
                        <input type="text" class="form-control" [(ngModel)]="nomR" placeholder="Nom et prénom">
                    </div>
                    <div class="mb-3">
                        <input type="text" class="form-control" [(ngModel)]="telR" placeholder="numero de téléphone">
                    </div>
                </div>
                <div class="card-footer border-0">
                    <button class="btn btn-warning w-100 mb-2" (click)="addTransfert()" [disabled]="isAddingTrans">
                        Initier le transfert
                        @if(isAddingTrans){
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        }
                    </button>
                    <button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal" >Anuler</button>
                </div>
            </div>
        </div>
      </div>
    </div>
</div>
<div class="modal modal-lg fade" id="staticBackdrop2" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-info">
          <h5 class="modal-title" id="staticBackdropLabel">Transfert réussi</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">            
            
        </div>
      </div>
    </div>
</div>
